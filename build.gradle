plugins {
    id 'java'
    id 'org.jetbrains.kotlin.jvm' version '1.9.10'
    id 'groovy'
}

subprojects {
    repositories {
        mavenCentral()
    }
}

kotlin {
    jvmToolchain(20)
} 

project(':java') {
    subprojects {
        apply plugin: 'java'
        dependencies {
            implementation 'com.google.guava:guava:32.1.1-jre'
        }
        sourceSets {
            main {
                java {
                    srcDirs = ['.']
                }
            }
        }
        buildDir = "../../bin/java/${projectDir.name}"
        java {
            toolchain {
                languageVersion = JavaLanguageVersion.of(21)
            }
        }
        defaultTasks "java-${projectDir.name}"
    }
    tasks.register('build') {
        group = 'Application (Java)'
        description = 'Builds all Java targets'
    }
    subprojects.each { subproject ->
        tasks.named("build").configure {
            dependsOn "${subproject.name}:build"
        }
    } 
}

project(':kotlin') {
    subprojects {
        apply plugin: 'kotlin'
        dependencies {
            implementation 'org.jetbrains.kotlin:kotlin-stdlib:1.9.10'
        }
        sourceSets {
            main {
                kotlin {
                    srcDirs = ['.']
                }
            }
        }
        buildDir = "../../bin/kotlin/${projectDir.name}"
        kotlin {
            jvmToolchain(20)
        }     
        defaultTasks "kotlin-${projectDir.name}"
    }
    tasks.register('build') {
        group = 'Application (Kotlin)'
        description = 'Builds all Kotlin targets'
    }
    subprojects.each { subproject ->
        tasks.named("build").configure {
            dependsOn "${subproject.name}:build"
        }
    } 
}